{% extends "base.html" %}

{% block title %}VPR: Find An Underwriter{% endblock %}
{% block description %}Underwriting on Vermont Public Radio delivers your businessâ€™s message to a desirable, statewide audience who appreciates your support of their station.{% endblock %}

{% block style %}
<link href="{{ url_for('static', filename='css/directory-style.css') }}" rel="stylesheet">
{% endblock %}

{% block head_script %}
<script type="text/javascript"
    src="{{ google_maps_url }}">
</script>
{% endblock %}

{% block content %}

<div class="container">
    <div id="directory" class="row">
        <div class="col-sm-6" id="underwriter-list">
            <div class="jumbotron">
                <h1>Underwriter Directory</h1>
                <p>Looking for an underwriter? Find them here by using the map
                or searching by letter.</p>
            </div>
            <div id="letters">
                {% for letter in list_of_letters %}
                    <a class="letters" href="{{ url_for('letter', letter=letter) }}">
                        {{ letter|capitalize }}</a>
                {% endfor %}
            </div>
            {% for underwriter in underwriters %}
                <div class="underwriter">
                    <h2>{{ underwriter.name }}</h2>
                    <p>
                    {% if underwriter.phone %}
                        {{ underwriter.phone }}<br />
                    {% endif %}
                    {% if underwriter.url %}
                        <a class="uw-link" href="{{ underwriter.url }}">
                            {{ underwriter.url }}<br /></a>
                    {% endif %}
                    {% if underwriter.address %}
                        {{ underwriter.address }}<br />
                        {% if underwriter.address2 %}
                            {{ underwriter.address2 }}<br />
                        {% endif %}
                        {{ underwriter.city }}, {{ underwriter.state }} {{ underwriter.zip }}
                    {% endif %}
                    </p>
                </div>
            {% endfor %}
        </div>
        <div class="col-md-6 google-maps" id="map-canvas"></div>
    </div>
</div>

{% endblock %}

{% block scripts %}
    <script type="text/javascript">

        var map = new google.maps.Map(document.getElementById("map-canvas"), {
          center: new google.maps.LatLng(43.953, -72.593),
          zoom: 8,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var locations = {{ locations|safe }};
        var infowindow = new google.maps.InfoWindow();

        var marker, i;
        for (var i = 0; i < locations.length; i++) {
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                map: map
            });

            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function() {
                    infowindow.setContent(locations[i][0]);
                    infowindow.open(map, marker);
                }
            })(marker, i));
        }


      /*google.maps.event.addDomListener(window, 'load', initialize);*/
    </script>
{% endblock %}
